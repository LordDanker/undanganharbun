<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Medical Gathering - Sinergi & Kolaborasi</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.2/dist/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.2/dist/ScrollTrigger.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
html, body { margin:0; padding:0; width:100%; height:100%; overflow:hidden; font-family:'Poppins', sans-serif; }
.swiper { width:100%; height:100vh; }
.slide { display:flex; justify-content:center; align-items:center; flex-direction:column; text-align:center; }

.bg1 { background:url('hb1.png') center/cover; color:white; }
.bg4 { background:#0d6efd; color:white; }

.card-rsvp { max-width:420px; margin:auto; border-radius:15px; }

#daftarRSVP li {
  display:flex; justify-content:space-between; padding:12px; font-size:1rem;
  border-bottom:1px solid rgba(0,0,0,0.15);
}

.flash { animation: flashAnim .7s; }
@keyframes flashAnim { 0%{background:#ff0}100%{background:white} }
</style>
</head>

<body>

<audio id="bg-music" loop>
  <source src="music.mp3" type="audio/mpeg">
</audio>

<div class="swiper">
  <div class="swiper-wrapper">

    <section class="swiper-slide slide bg1">
      <h4>Medical Gathering</h4>
      <h1 class="display-4 fw-bold" id="judul">Harapan Bunda Bandung</h1>
      <h4>Sinergi & Kolaborasi</h4>
      <p class="mt-3" id="undanganNama"></p>
      <button class="btn btn-light mt-4" onclick="openInvitation()">Buka Undangan</button>
    </section>

    <section class="swiper-slide slide bg4">
      <h2 class="fw-bold">Konfirmasi Kehadiran</h2>
      <div class="card card-rsvp mt-4 p-4 bg-white text-dark shadow">
        <form>
          <input class="form-control mb-3" id="undanganNama2" placeholder="Nama Anda" readonly>

          <div class="d-flex gap-2">
            <button type="button" class="btn btn-success w-50" onclick="setRSVP('Hadir')">Hadir</button>
            <button type="button" class="btn btn-danger w-50" onclick="setRSVP('Tidak Hadir')">Tidak Hadir</button>
          </div>
        </form>
      </div>
    </section>

    <section class="swiper-slide slide bg-white text-dark">
      <h2 class="fw-bold text-primary">Daftar Konfirmasi</h2>
      <ul id="daftarRSVP" class="list-group mt-4" style="max-width:450px;margin:auto;"></ul>
    </section>

  </div>
  <div class="swiper-pagination"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>

<script>
// INIT SWIPER
const swiper = new Swiper('.swiper', {
  direction:'vertical', speed:900, mousewheel:true,
  pagination:{ el:'.swiper-pagination', clickable:true },
});

// URL PARAMETER
const urlParams = new URLSearchParams(window.location.search);
const guestName = urlParams.get('to');

if (guestName) {
  const decodeName = guestName.replace(/\+/g, " ");
  document.getElementById("undanganNama").innerHTML = `Kepada Yth:<br><b>${decodeName}</b>`;
  document.getElementById("undanganNama2").value = decodeName;
}

function openInvitation() {
  document.getElementById("bg-music").play();
  swiper.slideNext();
}

// API ENDPOINT
const API_URL = "https://script.google.com/macros/s/AKfycbxmzJF_1uMNMOI2OuLUjHc_QEEbVVbPMYoimhE_Pz76Tl1PGk9ZNKHbz_tFhDZdgHQ/exec";

// SEND RSVP
function setRSVP(status) {
  let nama = document.getElementById("undanganNama2").value.trim();
  if (!nama) return alert("Silakan isi nama");

  fetch(API_URL, {
    method:"POST",
    body: JSON.stringify({ nama:nama, status:status })
  })
  .then(r => r.json())
  .then(res => {
    showConfetti();
    loadDataRSVP();
    swiper.slideNext();
  })
  .catch(err => alert("Error: " + err));
}

// LOAD FROM SHEET
function loadDataRSVP() {
  fetch(API_URL)
    .then(res => res.json())
    .then(data => {
      let html = "";
      data.forEach((item,i) => {
        let badge = item.status === "Hadir"
          ? `<span class="badge bg-success">Hadir</span>`
          : `<span class="badge bg-danger">Tidak Hadir</span>`;
        html += `
        <li class="list-group-item d-flex justify-content-between">
          <span><b>${i+1}.</b> ${item.nama}</span>
          ${badge}
        </li>`;
      });

      const el = document.getElementById("daftarRSVP");
      el.innerHTML = html;
      el.classList.add("flash");
      setTimeout(()=>el.classList.remove("flash"),600);
    });
}
loadDataRSVP();

// CONFETTI
function showConfetti() {
  const end = Date.now() + 1500;
  (function frame() {
    confetti({ particleCount:8, spread:70, origin:{y:0.9} });
    if (Date.now() < end) requestAnimationFrame(frame);
  })();
}

gsap.from("#judul", {scale:0.4, opacity:0, duration:1.5, ease:"elastic.out(1,0.4)"});
</script>

</body>
</html>
